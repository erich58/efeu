#include <mkmf.cfg>

BDIR=	$(EFEUTOP)/build

#if	_AIX
CTAGS=	ctags -tw
#else
CTAGS=	ctags -w
#endif

#define	PLIST(x)	Concat3($(BDIR)/,x,.d)

BASE=	PLIST(std) PLIST(synt) PLIST(wmm) PLIST(oestz)

usage::
	@echo "Aufruf: make all | clean | update | tags"
	@echo
	@echo "all	Generiert alles" 
	@echo "clean	Löscht alle generierten Dateien" 
	@echo "update	Erneuert die Sourceliste" 
	@echo "tags	Generiert ein tag-File für vi" 

all:: update

update::
	rm -f SourceBase
	make files

SourceBase:
	rm -f SourceList
	mksrclist $(BDIR) $@

SourceList: SourceBase
	-grep SourceList SourceBase | xargs sort -u > $@
	-grep d2m.list SourceBase | xargs sort -u >> $@
	-grep @"'\\.[ch]$$'" SourceBase | sort -u >> $@
	-grep @"'\\.[0-9]$$'" SourceBase | sort -u >> $@

clean::
	rm -f SourceBase SourceList

@!	Filelisten

FILES= C H TPL DEF MS ESH MSG CNF DOC MAN

files:: $(FILES)

clean::
	rm -f $(FILES)

C: SourceList; -grep @"'\\.c$$'" SourceList > $@
H: SourceList; -grep @"'\\.h$$'" SourceList > $@
SRC: SourceList; -grep @"'\\.src$$'" SourceList > $@
TPL: SourceList; -grep @"'\\.tpl$$'" SourceList > $@
DEF: SourceList; -grep @"'\\.def$$'" SourceList > $@
MS: SourceList; -grep @"'\\.ms$$'" SourceList > $@
ESH: SourceList; -grep @"'\\.esh$$'" SourceList > $@
MSG: SourceList; -grep @"'\\.msg$$'" SourceList > $@
CNF: SourceList; -grep @"'\\.cnf$$'" SourceList > $@
DOC: SourceList; -grep @"'\\.doc$$'" SourceList > $@
MAN: SourceList; -grep @"'\\.[0-9]$$'" SourceList > $@

@!	Kennungsfile für vi

all:: tags

clean::
	rm -f tags

tags: C H
	rm -f $@
	cat C H | xargs $(CTAGS) -a

