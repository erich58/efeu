#!/bin/sh
# :*:create Makefile for configuration tools
# :de:Makefile für Basiswerkzeuge generieren
#
# Copyright (C) 2001 Erich Frühstück
# This file is part of EFEU.
# 
# EFEU is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
# 
# EFEU is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty
# of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See the GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public
# License along with EFEU; see the file COPYING.
# If not, write to the Free Software Foundation, Inc.,
# 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.

: ${LANG:=en}

# get top directory (absolut path needed)

if [ $# -ge 1 ]; then
	top=$1
else
	top="../.."
fi

top=`(cd $top || exit 1; pwd)` || exit 1
cd `dirname $0` || exit 1

src=`pwd`
gen=`basename $0`
bootstrap="$@"
def="Makefile.in"

# create Makefile

. Rules

case $LANG in
de*)	printf "# Nicht editieren, Datei wurde automatisch generiert\n\n" ;;
*)	printf "# do not edit, file was created by $0\n\n" ;;
esac

printf "$fmt_head"
mf_var TOP "$top"
mf_var SRC "$src"
mf_var BIN "\$(TOP)/bin"

mf_target all check
mf_rule "setup:" "" "(cd $src; ./setup $top)"
mf_rule check: setup "@mksrclist \$(SRC) SourceList || \$(MAKE) all"
mf_rule SourceList: setup "-mksrclist \$(SRC) SourceList"
mf_rule update: setup "rm -f SourceList; \$(MAKE) all"

mf_target Makefile "\$(SRC)/$gen \$(SRC)/Rules \$(SRC)/Makefile.in SourceList"
mf_cmd	"(cd $src; ./setup $top)"
mf_cmd	"(cd $src; ./$gen $bootstrap) > Makefile"

. Makefile.in
