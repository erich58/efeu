.\"	Handbucheintrag fuer mdmat
.\"	(c) 1993 Erich Fruehstueck
.\"	A-1090 Wien, Währinger Strasse 64/6
.\"
.TH mdmat 4 "" "MDMAT \- Programmbibliothek"
.SH BEZEICHNUNG
mdmat
\-
Format einer
multidimensionalen
Datenmatrix
.SH BESCHREIBUNG
Eine multidimensionale Datenmatrix ist ein mehrdimensionales
Schema von Datenobjekten. Die Datenobjekte sind durch einen
Objektnamen und der Objektlänge (Benötigter Speicherplatz)
charakterisiert und ansonsten beliebig. In der Regel werden
standardisierte Datenobjekte verwendet, die sich aus Basistypen
ableiten lassen, siehe weiter unten. Die einzelnen Dimensionen
werden als Achsen bezeichnet und sind durch einen Namen gekennzeichnet.
Jede Achse definiert einen Vektor.
Die Datenmatrix wird normalerweise als binäre Datei gespeichert,
sie kann aber auch als Textdatei gespeichert werden.
.SS "Standardisierte Datentypen"
Die Standardisierten Datentypen bauen auf den 4 Grundtypen

.nf
\fIchar \fR	1 Byte Ganzzahlwert
\fIshort\fR	2 Byte Ganzzahlwert
\fIlong \fR	4 Byte Ganzzahlwert
\fIfloat\fR	4 Byte Gleitkommawert
\fIdouble\fR	8 Byte Gleitkommawert
.fi

auf. Diese Grunddtypen können direkt als unbenannter Datentype angegeben
werden. Alternativ dazu kann auch ein bennanter Datentype in der Form
\fItype name\fR angegeben werden.

Zu einem Datentyp können mehrere Variablennamen, getrennt durch Komma
angegeben werden. Mehrere Datentypen können durch Strichpunkt
zusammengefaßt werden, z.B: in der Form

.nf
	long anz, tage; double mittel
.fi

Hier besteht der Datentyp aus den zwei Ganzzahlwerten \fIanz\fR und
\fItage\fR, sowie der Gleitkommazahl \fImittel\fR. Nach \fImittel\fR
könnte auch ein Strichpunkt stehen, dieser ist jedoch optional.

Eine mit { } geklammerte Variablenliste bildet eine Struktur von
Datenelementen und kann wie ein gewöhnlicher Datentyp verwendet
werden. Steht vor { } ein Name, wird gleichzeitig ein neuer
Datentyp definiert und kann an anderer Stelle verwendet werden.
Der Name einer Komponente einer Struktur setzt sich aus den
Strukturnamen und den Komponentennamen, getrennt durch einen Punkt,
zusammen.

Die durch 

.nf
	DATA { long anz; double val } x; { int a; DATA b } y
.fi

definierte Struktur hat somit die Komponenten
\fIx.anz\fR, \fIx.val\fR, \fIy.a\fR, \fIy.b.anz\fR und \fIy.b.val\fR,
wobei zusätzlich der Datentype \fIDATA\fR deklariert wurde und wie
ein Basistype eingesetzt werden kann.

Obwohl Variablennamen nicht in jedem Fall erforderlich sind, sollten sie
jedoch außer bei reinen Basistypen immer angegeben werden, da bestimmte
Programme den Namen der Variablen zum Zugriff benötigen.
.SS "Gepacktes Datenformat"
Ein gepacktes, oder binäres Datenfile besteht aus den Sektoren: Kopf,
Achsendimensionen, Textteil, Datenteil und EOF-Kennung.

Der Kopfteil des binären Datenfiles besteht aus der Struktur

.nf
typedef struct {
	ushort_t magic;	/* Magic - Number */
	ushort_t dim;	/* Zahl der Achsen */
	ulong_t space;	/* Speicherbedarf für Strings */
	ulong_t size;	/* Länge eines Datenobjektes */
	ulong_t nel;	/* Zahl der Datenobjekte */
} MD_FILEHDR;
.fi

Die ersten zwei Byte des Datenfiles beinhalten eine Magicnummer.
Diese hat den Wert 0xD0EF und dient zur Kennzeichnung der Datei
als multidimensionale Datenmatrix. Danach folgt die Zahl der Achsen
der Datenmatrix (2 Byte Wert). Die restlichen drei Variablen des
Kopfes bestimmen den notwendigen Speicherbedarf für die Datenmatrix.

Die Achsendimensionen werden als Zahlenwerte vom Type ushort_t
gespeichert.

Der Textteil enthält den Titel, die Bezeichnung des Datenobjektes,
die Achsennamen und die Achsenindizes.
Die einzelnen Wörter des Textteiles sind durch ein Nullzeichen getrennt.
Die Länge des Textteiles wird auf ein vielfaches von 2 Byte aufgerundet.

Der Datenteil enthält die Daten in gepackter Form entsprechend
der Zahl der Datenobjekte \fInel\fR und deren Länge \fIsize\fR.

Die EOF-Marke besteht aus der Zeichenfolge "*EOF". Sie erlaubt eine
einfache Konsistenzprüfung des Datenfiles.

.SS "ASCII-Datenformat"
Das ASCII-Format hat einen analogen Aufbau wie das gepackte Datenformat.
.\"Zu Beginn des Files steht die Kennung "!MDMAT", gefolgt von der
.\"Dimensionszahl und dem Objekttype. Der Objekttype muß dabei aus
.\"Basistypen aufgebaut sein, für die bekannt ist, wie die Datenwerte
.\"gelesen werden sollen. Die Kennung, die Dimensions und der Objekttype
.\"stehen in der Regel in einer Zeile und sind durch Strichpunkt oder
.\"weiße Zeichen (Leerzeichen, Tabulator, Zeilenvorschub, ...) getrennt.
.\"Der Objekttype selbst darf Strichpunkt und weiße Zeichen, aber keinen
.\"Zeilenvorschub enthalten.

WIRD NOCH AUSGEFHÜHRT
.\"Die nächste Zeile enthält den Titel der Datenmatrix.
.\"Danach folgen die Achsendefinitionen. Jede Achsendefinition
.\"besteht aus einer Zeile mit der Achsendimension und dem Achsennamen,
.\"danach folgen die Achsenbezeichner (beliebig auf Zeilen aufgeteilt).

.\"Der Datenteil wird mit der Kennung "*DATA" eingeleitet. Danach folgen
.\"die Zahlenwerte entsprechend der Reihenfolge der Achsen. Die letzte
.\"Achse variiert dabei am schnellsten. Bei zusammengesetzten Datentypen,
.\"gibt es für jede Komponente einen entsprechenden Zahlenwert.

.\"Die einzelnen Zahlenwerte sind wieder durch Strichpunkt und weiße
.\"Zeichen getrennt. In der Regel werden zur leichteren Lesbarkeit
.\"alle Werte zu einem Datenobjekt
.\"(oder bei einfachen Datenobjekten zur letzten Achsendimension)
.\"in einer Zeile geschrieben.
.\"Der Datenteil wird wieder durch die Endekennung "*EOF" abgeschlossen.

.\"In einem ASCII-Datenfile können beliebig Kommentare und Leerzeilen
.\"vorkommen. Nur die Kennung "!MDMAT" muß zu Beginn des Datenfiles
.\"stehen. Kommentare können entweder in C++-Syntax (Durch /* ... */
.\"oder // ... Zeilenvorschub begrenzt), oder durch Zeilen, die mit einem
.\""#"-Symbol beginnen, geschrieben werden.

.\"Ein Backslash hebt die Sonderbedeutung eines Zeichens (und des Backslash
.\"selbst) auf. Damit können Trennzeichen in einem Namen markiert werden.
.\"Die Kombination Gegenschrägstrich Zeilenvorschub wird ignoriert, damit
.\"lassen sich auf einfache Weise Zeilen fortsetzen. Dies kann z.B: bei
.\"einem komplexen Datentyp oder einem langen Titel von Nutzen sein.
.SH BEISPIEL
Zur Veranschaulichung ist im folgenden die ASCII-Version eines einfachen
Datenfiles aufgelistet:
.nf
	##MDMAT	2.0
	##Titel	Testdatei
	##Objekt	double
	##Zeilen	y
	##Spalten	x
	5	x1	x2	x3	x4	x5
	y1	1.1	2.2	3.3	4.4	5.5
	y2	0	1.1	2.2	3.3	4.4
	y3	-1.1	0	1.1	2.2	3.3
	y4	-2.2	-1.1	0	1.1	2.2
	y5	-3.3	-2.2	-1.1	0	1.1
.fi
.SH "SIEHE AUCH"
mdprint(1), mdread(1).
.SH WARNUNGEN
Die Byteordnung der Daten in einer gepackten Datewnmatrix hängt vom
jeweiligen Prozessortype ab. Gepackte Datenmatrizen sind also nur
bedingt übertragbar. Bei Gleitkommazahlen können auch Inkompatiblitäten
bezüglich der binären Repräsentation der Zahlenwerte auftreten.
.SH FEHLER
