#!/lbin/esh
Ident = "Lorenzkurven";

int NP = 100;
int deg = 0;
int mode = 0;
double seg = 1.;
double segoffset = 0.;
str Name = "FRAU";
str Output = NULL;

PgmOpt("p", "Output=\"|lpr\"", "Ausgabe zum Drucker")
PgmOpt("a val", "mode=1;seg=#1", "Anfang")
PgmOpt("e val", "mode=2;seg=#1", "Ende")
PgmOpt("o offset", "segoffset=#1", "Ende")
PgmOpt("d deg", "deg=#1", "Ableitung")
PgmOptArg("name", "Name=#1", "Dateiname")

loadarg;

#include <Plot>

system(psub("dezile -r -l $(Name).x  -v - -m $(Name) /dev/null"));
system(psub("dezile -r -s -l $(Name).s  -v - -m $(Name) /dev/null"));
Polynom px = pnload(Name + ".x");
Polynom ps = pnload(Name + ".s");

double x[NP + 1], yx[NP + 1], ys[NP + 1];
double z;

for (int i = 0; i <= NP; i++)
{
	x[i] = i / (double) NP;

	if	(mode == 2)	x[i] = 1. - segoffset - seg * (1 - x[i]);
	else if	(mode == 1)	x[i] = segoffset + seg * x[i];

	yx[i] = px(x[i], deg);
	ys[i] = ps(x[i], deg);
}

Plot plot = Plot(sprintf("%s: %d. Ableitung", Name, deg), Output);
plot.data("linear test spline", x, yx, ys);
plot = NULL;
