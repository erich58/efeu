\Name
PrintFunc -- Konstruktion einer Ausgabefunktion
\Synopsis
\tthang
\#include \<printfunc.ms\>

int Function::pfbody \& (IO <def>, str <name>,
str <vardef>, bool <in_switch> = false)

void PrintFunc (str <name>, str <args>, IO <def>, bool <glob> = true)

\Description

Die Funktion |Function::pfbody| dient zur Konstruktion von
Ausgabefunktionen.
Die Eingabestruktur <def> enthält die
einzelnen Definitionszeilen für den Funktionsrumpf.
Das Argument <name> ist der Name, der für die
Ausgabestruktur eingesetzt wird.
Das Argument <vardef> enthält eine Formatdefinition zur Aufbereitung
des Datenwertes einer Definitionszeile.
Die Variable <in_switch> wird für einen rekursiven
Aufruf von |Function::pfbody| innerhalb eines Switch-Bereichs
benötigt.

Falls der Rückgabewert verschieden von 0 ist, empfiehlt sich
aus rein optischen Gründen das Einfügen einer Leerzeile in den
Funktionsrumpf.

Die Funktion |PrintFunc| erzeugt eine einfache Ausgabefunktionen mit
Rückgabetype und Namen <name>, einer IO-Struktur mit Namen |out| als erstes
Argument und den zusätzlichen Variablen <args>.
Falls <glob> wahr ist, wird die Ausgabefunktion global erzeugt,
ansonsten lokal.

\shead	Syntax
Die einzelnen Definitionszeilen bestehen aus einem Schlüsselwort <key>
und einem Formatstring <fmt>. Soll das Schlüsselwort Leerzeichen oder
Tabulatoren enthalten, müssen diese mit einem Backslash markiert
werden.
Der Formatstring beginnt beim ersten nichtweißen Zeichen nach
dem Schlüsselwort und kann beliebig viele Leerzeichen oder Tabulatoren
enthalten.
Die Befehlszeilen können beliebig eingerückt werden.

Befehlszeilen, die mit einem Klammeraffen beginnen, dienen
zur Konstruktion von Testblöcken und Switch-Anweisungen.
[|@if|]
	leitet einen Testblock ein. Der Formatstring definiert
	den Testausdruck.
[|@elif|]
	definiert eine Alternative (optional). Der Formatstring definiert
	den Testausdruck.
[|@else|]
	definiert die sonstigen Fälle (optional).
[|@end|]
	beendet einen Testblock oder eine Switch-Anweisung.

[|@switch|]
	leitet ein Switch-Anweisung ein. Der Formatstring definiert
	den Schaltwert.
[|@case|]
	definiert eine spezielle Ausprägung.
[|@default|]
	definiert die sonstigen Fälle in der Switch-Anweisung.

Bei allen anderen Zeilen definiert der Formatstring die Befehlszeile
im Funktionsrumpf und das Schlüsselwort den Datenwert.
Dabei gelten folgende Regeln:
*	Bei einem Punkt als Schlüsselwert wird der Datenwert auf NULL gesetzt.
	(Platzhalter, wenn kein Datenwert benötigt wird)
*	Falls <vardef> verschieden von Null ist, wird
	Parametersubstitution auf <vardef> angewendet, wobei Register 1
	mit dem Schlüsselwort belegt wird.
*	Ansonsten wird Parametersubstitution auf das Schlüsselwort
	angewendet.

Das erste Zeichen im Formatstring gilt als Steuerzeichen und gehört
nicht zum eigentlichen Format.
[|$|]
	Der Datenwert wird mit Parametersubstitution im Format
	eingebaut und das Resultat ausgegeben.
[|"|]
	Das Format wird als String ausgegeben,
	der Datenwert wird ignoriert.
[|'|]
	Das Format wird als Zeichendefinition ausgegeben,
	der Datenwert wird ignoriert.
[|#|]
	Die Ausgabe erfolgt mit |io_printf|
[|?|]
	Der Datenwert liefert einen Testausdruck, das Format muß
	von der Form |"|<str1>|" : "|<str2>|"| , |'|<a>|' : '|<b>|'| oder
	<fmt1>|:|<fmt2> sein. Im letzten Fall kann |:| <fmt2>
	entfallen (wird durch NULL ersetzt) und <fmt1> bzw. <fmt2>
	wird mit |io_printf| ausgegeben. Der Datenwert kann eingebaut
	werden! Achtung: Leerzeichen gehören zum jeweiligen Format.
[|=|]
	Das Format besteht aus einer Liste von Strings, der Datenwert bestimmt
	den Index (beginnend bei 0). Der erste String ist Vorgabewert
	für Indexwerte außerhalb des zulässigen Bereichs.

Beginnt das Format mit keinem dieser Zeichen, wird der Datenwert mit
Parametersubstitution eingebaut und das Resultat liefert den Ausdruck
im Funktionsrumpf. Der Name der Ausgabeeinheit steht in Register 2.
Ein Backslash am Anfang der Formatanweisung gilt als Fluchtsymbol.

\SeeAlso
\mref{mksource(1)}, \mref{function(7)}.
