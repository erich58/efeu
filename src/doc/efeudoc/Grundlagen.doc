\author	Erich Frühstück
\title	Grundlagen
Dieses Dokument gibt einen kurzen Überblick über die Syntax
von Beschreibungsdateien für efeudoc.

\sec	Grundelemente

\margin	Zeichensatz
Ein Dokument kann beliebige Zeichen des Latin1-\index{Zeichensatz}es
(ISO~8859-1) enthalten. In der Regel werden diese unverändert an die Ausgabe
übertragen. Davon ausgenommen sind weiße Zeichen und Sonderzeichen.

Von den weißen Zeichen wird nur das Leerzeichen, der Tabulator und
der Zeilenvorschub interpretiert.
Tabulatoren werden automatisch in
Leerzeichen expandiert. Tabulatorbreite ist dabei 8 Zeichen.
Mehrere aufeinanderfolgende Leerzeichen gelten im Regelfall wie
ein einzelnes Leerzeichen.
Eine Leerzeile trennt einzelne Absätze.

\margin	Einrücktiefe
Leerzeichen und Tabulatoren am Anfang einer Zeile werden
nicht ausgegeben, sondern bestimmen die aktuelle \index{Einrücktiefe}.
Diese dient zur automatischen Verwaltung von listenähnlichen
Strukturen. Bei Tabellenzeilen und bei Befehlen mit langen Argumenten
dient die Einrückung zur Kennzeichnung von Fortsetzungszeilen.

\margin	Kommentare
Eine Beschreibungsdatei kann \index{Kommentare} im C++-Stil enthalten.
Diese sind etweder durch  |/*| &ldots; |*/| oder durch |//| &ldots; Zeilenvorschub
begrenzt, wobei der Zeilenvorschub selbst nicht zum Kommentar
gerechnet wird.

Beginnt ein Kommentar unmittelbar am Zeilenanfang, wird ein dem
Kommentar folgender Zeilenvorschub unterdrückt.  Bei der Entfernung
eines Kommentars aus dem Eingabestrom kann damit nie eine Leerzeile
(Absatztrennung!) entstehen.

\margin	Namen
Befehle, Makros und Sonderzeichen werden durch einen \index{Namen}
gekennzeichnet.
Dieser muß mit einem Buchstaben beginnen und darf nur aus Buchstaben
und Ziffern bestehen. Ein \index{Unterstreichungssymbol} gilt als Buchstabe.

Folgt auf einem Namen ein Leerzeichen oder ein Tabulator, werden alle
folgenden Leerzeichen und Tabulatoren entfernt. Folgt auf einen Namen
ein Strichpunkt, wird dieser entfernt.
Jedes andere Zeichen nach einem Namen bleibt erhalten.

\margin	\index{Ligaturen}
Dabei handelt es sich um gewisse Buchstabenkombinationen,
bei deren Zusammentreffen ein neues Zeichen gebildet, oder
einzelne Zeichen anders gesetzt werden. Folgende Ligaturen
sind definiert:
*	Ein einzelnes Minuszeichen \index{|-|} wird als kurzer Strich -, zwei
	aufeinanderfolgende Minuszeichen \index{|--|} werden als mittellanger
	Strich -- und drei aufeinanderfolgende Minuszeichen \index{|---|}
	werden als langer Strich --- gesetzt.
*	Ein Plus |-| oder ein Minus \index{|+|} vor einer Ziffer wird im
	mathematischen Modus gesetzt.

\margin	Fluchtsymbol

Der Dokumentgenerator kennt eine Reihe von Steuerzeichen.
Zu ihrer Ausgabe wird als \index{Fluchtsymbol} der
\index{Gegenschrägstrich}~|\|
verwendet. Dieser dient auch zur Kennung eines Dokumentbefehls.
Grundsätzlich gilt: folgt einem Gegenschrägstrich ein
alphanumerisches Zeichen oder ein Unterstreichungssymbol, handelt es
sich um einen Dokumentbefehl, ansonsten wird das nachfolgende Zeichen
wie ein gewöhnliches Zeichen behandelt, unabhängig davon ob es sich
um ein Sonderzeichen handelt oder nicht.

Für die Maskierung mit dem Fluchtsymbol gelten folgende Regeln:
*	Die Zeichen |\|, |@|, |&|, |<|, |>|, |||| und |~|
	benötigen immer das Fluchtsymbol.
*	Ein Zuweisungszeichen |=| nach einem Befehl- oder Makronamen
	benötigt das Fluchtsymbol.
*	Die Zeichen |*|, |#| und |[| benötigen am Anfang einer Zeile
	oder im Tabellensatz das Fluchtsymbol.
*	Einzelne Steuerzeichen oder Befehle können die syntaktische
	Bedeutung einzelner Zeichen vorübergehend ändern.
*	Damit eine Kommentarkennung |/*| und |//| nicht interpretiert wird,
	ist eines der Zeichen zu maskieren.
*	Ligaturen können wahlweise durch Maskierung eines Zeichens
	oder durch Einfügen von leeren Kommentaren |/**/| aufgehoben werden.
*	Bei Befehls- und Makroargumenten gelten eigene
	Maskierungsregeln, sie werden im Abschnitt \vref{macro}
	beschrieben.

\margin	Sonderzeichen
Satztechnische Zeichen (z.B: Umbruchstellen), nicht zum
Latin1-gehörende Zeichen und schwer über die Standardtastatur
eingebbare Zeichen werden als \index{Sonderzeichen} bezeichnet.

Ein Sonderzeichen wird mit dem Steuerzeichen \index{|&|} eingeleitet,
danach folgt der Name des Sonderzeichens oder ein einzelnes,
nichtnumerisches Zeichen. Als Namenskonvention wird der
<"ISO Character Entity Sets Catalog"> (ISO 8879:1986) verwendet.

Die nichtnumerischen Zeichen werden für
häufig verwendete Sonderzeichen eingesetzt. Ist die entsprechende
Zeichenkombination nicht definiert, wirkt |&| wie ein Fluchtsymbol.
Derzeit wird nur |&-| für das Sonderzeichen \index{|&shy;|}, das eine
Umbruchstelle markiert, verwendet.

Für das häufig benötigte Leerzeichen ohne Umbrucherlaubnis wird
das Steuerzeichen \index{|~|} (entspricht \index{|&nbsp;|}) verwendet.

\margin	Absätze
Die Grundelemente eines Dokumentes sind Absätze. Diese werden
voneinander durch Leerzeilen getrennt. Bei Befehlen, die einen
neuen Absatz erzwingen, kann die Leerzeile entfallen. Die Zahl
der Leerzeilen zwischen einem Absatz ist beliebig.

Es wird zwischen logischen und physikalischen Absätzen
unterschieden:
*	Ein logischer Absatz ist ein Absatz im Sinne des generierten
	Dokumentes.
*	Ein physikalischer Absatz ist ein von einer Leerzeile
	abgeschlossener Textblock, der durchaus aus mehreren logischen
	Absätzen bestehen kann.

\sec	Makrodefinitionen

\label{macro}

Das Kommando |efeudoc| kennt zwei Formen von Makrodefinitionen:
Textmakros und Dokumentbefehle.

\margin	Textmakros
\index{Textmakros} werden mit einem Klammeraffen~\index{|@|} eingeleitet,
danach folgt der Befehlsname und optional eine Parameterliste der Form:
	|(|<arg1>|,|<arg2>|,| &ldots;, <argn>|)|.
Die Parameter werden in den Textstring eingemischt.

Zur Maskierung von Trennzeichen werden einfache Anführungszeichen~|'|
verwendet. Ein Anführungszeichen selbst wird durch zwei
aufeinanderfolgende Anführungszeichen dargestellt. Alle anderen
Zeichen der Parameterliste werden unverändert übernommen.

Als Parameterkennung wird der Dollar \index{|$|}, gefolgt von der
Parameternummer verwendert. Die Kennung |$*| steht für alle
Argumente. Beim Mischen wird daruf Rücksicht genommen, ob die
Parameterkennung unter Anführung steht oder innerhalb runder Klammern
steht:
*	Bei einer Anführung wird der Parameter als esh-String ausgegeben.
	Eine Parameterliste wird durch Komma getrennt. Dient zur
	Übergabe von Parametern an einen esh-Ausdruck.
*	Innerhalb einer Klammer wird dafür gesorgt, daß die Zeichen
	|(|, |,| und |)| maskiert werden. Eine Liste wird durch
	Komma getrennt. Dient zur Übergabe von Parametern an einen
	Textmakro.
*	Ansonsten werden die Zeichen unverändert ausghegeben. Eine
	Liste wird durch ein Leerzeichen getrennt.

\margin	Dokumentbefehle
\index{Dokumentbefehle} werden mit einem Gegenschrägstrich~\index{|\|}
eingeleitet, danach folgt der Befehlsname. Befehle sind esh-Ausdrücke.

Eine Reihe von Befehlen benötigt Parameter.
Bezüglich der Parametersyntax gibt es nur Konventionen
und keine vorgegebene Struktur. Die Befehle sind frei in esh
programmierbar und holen sich ihre Parameter selbst aus dem
Eingabestrom. Dazu gibt es eine Reihe von eingebauten Parsefunktionen.
Näheres dazu kann im |efeudoc|-Programmierhandbuch nachgelesen werden.

\margin \index{Makrodefinition}
Folgt nach einem Makronamen (Befehl oder Textmakro) ein
Zuweisungszeichen~|=| wird der Makro mit dem nachfolgenden \index{Ausdruck}
definiert. Es gibt folgende Varianten:
*	Beginnt ein Ausdruck mit einer geschwungenen Klammer,
	endet er bei der ersten geschwungenen Klammer der gleichen
	Verschachtelungstiefe. Klammern in Strings werden nicht
	berücksichtigt. Die Klammern gehören nicht zum Ausdruck.
	Nachfolgende weiße Zeichen und ein einzelner Zeilenvorschub
	werden entfernt.
*	Beginnt ein Ausdruck mit einem Zeilenvorschub, endet
	er bei der ersten Leerzeile (physikalischer Absatz).
*	Ansonsten gehören alle Zeichen bis zum nächsten
	Zeilenvorschub zum Ausdruck.

\sec	Einbinden von Dateien

Mit dem Befehl \index{|\include|} können Dateien eingebunden werden.
Er hat die Syntax:
	|\include[|<flags>|]| <name>

Die Datei <name> wird entsprechend dem Suchpfad für Dokumente
gesucht. Einthält <name> einem Schrägstrich~|/|, wird während der
Verarbeitung der Suchpfad um den Bibliotheksnamen der Datei
erweitert.

Die Steuerflags <flags> bestimmen die Verarbeitung der Datei.
Folgende Angaben sind möglich:
[|config|]
	Die Datei wird als Konfigurationsdatei geladen.
	Es kann nicht mit anderen Flags kombiniert werden.
[|eval|]
	Die Datei wird mit zunächst mit dem esh-Interpreter ausgewertet.
[|geval|]
	Wie |eval|, aber neue Variablen und Funktionen werden global
	eingerichtet.
[|verbatim|]
	Der Inhalt wird wortwörtlich in Schreibmaschinenschrift
	dargestellt.
[|latex|]
	Die Datei enthält LaTeX-Code.
[|html|]
	Die Datei enthält HTML-Code.
[|man|]
	Die Datei enthält nroff-Code für Handbucheinträge.
[|ignore|]
	Der Inhalt der Datei wird ignoriert.

Die Flags |latex|, |html| und |man| werden in der Regel mit
|verbatim| oder |ignore| kombiniert. Fals der Ausgabetreiber
die Datei nicht verarbeiten kann, wird auf die Alternative
zugegriffen.

Der Parameter <flags> kann auch ein Kommando enthalten, durch das die
Daten gefiltert werden. Es wird mit dem Pipe-Symbol |||| eingeleitet.
Fals |eval| gesetzt ist, werden die Daten zuvor mit dem
esh-Interpreter verarbeitet. Alle anderen Flags beziehen sich auf
die Verarbeitung der gefilterten Daten.

Beispiel: der Befehl
	|\include[eval latex verbatim || gnuplot] diag.def|
wertet die Datei mit den esh-Interpreter aus, schickt das Ergebnis
an das Kommando |gnuplot| und interpretiert das Resultat als
\LaTeX-Befehle. Falls der Ausgabetrieber diese nicht verarbeiten kann,
werden die Befehle wortwörtlich dargestellt.

\margin	Eingabebereich
Durch mindestens vier Minuszeichen |----| wird ein \index{Eingabebereich}
abgetrennt. Er wird wie eine extern eingebundene Datei behandelt.
Die genaue Syntax lautet:
	|----| <Parameter>\br
	<Eingabebereich>\br
	|----| <Kommentar>\br

Eingabebereiche werden sehr häufig zum Auswerten von esh-Sequenzen
als Alternative zum |\eval|-Befehl verwendet.

\margin	\index{Bedingte Verarbeitung}

Mithilfe der Befehle \index{|\if|}, \index{|\else|} und
\index{|endif|} ist eine bedingte
Verarbeitung möglich. Nach |\if| kommt ein esh-Ausdruck für den
die gleichen Syntaxregeln wie für die Makrodefinitionen gelten.
Ist der Ausdruck wahr, wird alles bis zu Schlüsselwort |\else|,
ansonsten alles nach |\else| verarbeitet. Der Testbereich endet
bei |\endif|. Das Schlüsselwort |\else| kann entfallen.

Testblöcke können beliebig verschachtelt werden. Eingabebereiche
innerhalb eines Testblocks werden unverändert übernommen.

\margin	\index{Bedingter Ausdruck}
Der Textmakro |@if| mit den drei Argumenten <expr>, <ifpart> und
<elsepart> stellt einen bedingten Ausdruck dar. Er kann für
einfachere Testabfragen verwendet werden.
